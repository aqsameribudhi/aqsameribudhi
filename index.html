<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>aqsameribudhi üíï</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      background: linear-gradient(#fff0f5, #ffe6ef);
      margin: 0;
      padding: 16px;
      text-align: center;
    }

    h1 {
      color: #d63384;
      font-size: 28px;
      margin: 8px 0 2px;
    }

    p {
      margin: 0 0 14px;
      color: #6b3b52;
      font-size: 14px;
    }

    .today {
      background: white;
      border-radius: 18px;
      padding: 18px;
      margin: 16px auto 18px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
      max-width: 700px;
      text-align: left;
    }

    .today h2 {
      color: #d63384;
      margin: 0 0 12px;
      text-align: center;
    }

    .section {
      margin-top: 16px;
    }

    .section h3 {
      margin: 6px 0;
      color: #555;
      font-size: 15px;
    }

    textarea {
      width: 100%;
      height: 120px;
      border-radius: 12px;
      padding: 12px;
      border: 1px solid #ddd;
      font-size: 15px;
      resize: none;
      outline: none;
    }

    textarea:focus {
      border-color: rgba(214, 51, 132, 0.45);
      box-shadow: 0 0 0 3px rgba(214, 51, 132, 0.12);
    }

    .save-btn {
      margin-top: 8px;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 25px;
      background: #d63384;
      color: white;
      font-size: 15px;
      cursor: pointer;
      transition: transform 0.08s ease, opacity 0.2s ease;
    }

    .save-btn:active {
      transform: scale(0.99);
    }

    .days {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 10px;
      margin-top: 12px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .day {
      background: white;
      padding: 14px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      user-select: none;
      transition: transform 0.08s ease, box-shadow 0.2s ease;
    }

    .day:hover {
      transform: translateY(-1px);
      box-shadow: 0 7px 16px rgba(0, 0, 0, 0.12);
    }

    #editor {
      display: none;
      margin-top: 16px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      background: white;
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
      text-align: left;
    }

    #editor h2 {
      margin: 0 0 10px;
      color: #d63384;
      text-align: center;
    }

    /* ---------- Interactive Media Controls ---------- */

    .media-block {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid #f2d3e3;
    }

    .media-title {
      margin: 0 0 10px;
      color: #5b4a52;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .btn {
      border: none;
      border-radius: 14px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: transform 0.08s ease, opacity 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }

    .btn:active {
      transform: scale(0.99);
    }

    .btn-primary {
      background: #d63384;
      color: white;
    }

    .btn-soft {
      background: #ffe0ef;
      color: #a11d59;
    }

    .btn-danger {
      background: #ff4d6d;
      color: white;
    }

    .btn[disabled] {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .hint {
      font-size: 12px;
      color: #7a6871;
      margin-top: 6px;
    }

    .status {
      font-size: 12px;
      color: #7a6871;
      margin: 6px 0 0;
    }

    /* Photo previews */
    .thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .thumb {
      width: 92px;
      height: 92px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      background: #fff;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* Audio list */
    .audio-list {
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    .audio-item {
      background: #fff6fb;
      border: 1px solid #ffd2e7;
      padding: 10px;
      border-radius: 12px;
    }

    .audio-item audio {
      width: 100%;
    }

    /* Hide the real file input (we trigger it from the button) */
    input[type="file"] {
      display: none;
    }
  </style>
</head>

<body>
  <h1>aqsameribudhi üíñ</h1>
  <p>riphah walon ki aesi ki tesi</p>

  <!-- TODAY -->
  <div class="today">
    <h2 id="todayTitle"></h2>

    <div class="section">
      <h3>üíô My Thoughts</h3>
      <textarea id="myToday" placeholder="Write your thoughts..."></textarea>
      <button class="save-btn" onclick="saveToday('my')">Save My Thoughts</button>
    </div>

    <div class="section">
      <h3>üíñ My Food Panda Thoughts</h3>
      <textarea id="herToday" placeholder="Write your thoughts..."></textarea>
      <button class="save-btn" onclick="saveToday('her')">Save My Food Panda Thoughts</button>
    </div>

    <!-- MEDIA (Today) -->
    <div class="media-block">
      <div class="media-title">üì∏ Memories (Photos)</div>

      <div class="btn-row">
        <button class="btn btn-primary" id="addPhotosBtn" type="button" onclick="triggerPhotoPick()">
          üì∑ Add Photos
        </button>
        <button class="btn btn-soft" id="clearTodayPhotosBtn" type="button" onclick="clearPhotosForDay(currentDayNumber)">
          üóëÔ∏è Clear Photos (Today)
        </button>
      </div>

      <input id="photoInput" type="file" accept="image/*" multiple />
      <div class="status" id="photoStatus">No photos added yet.</div>
      <div class="thumbs" id="photoThumbs"></div>

      <div class="media-title" style="margin-top:16px;">üéôÔ∏è Memories (Voice)</div>

      <div class="btn-row">
        <button class="btn btn-primary" id="startRecBtn" type="button" onclick="startRecording()">
          ‚è∫Ô∏è Start Recording
        </button>
        <button class="btn btn-danger" id="stopRecBtn" type="button" onclick="stopRecording()" disabled>
          ‚èπÔ∏è Stop & Save
        </button>
        <button class="btn btn-soft" id="clearTodayVoicesBtn" type="button" onclick="clearVoicesForDay(currentDayNumber)">
          üóëÔ∏è Clear Voice (Today)
        </button>
      </div>

      <div class="status" id="voiceStatus">No voice notes yet.</div>
      <div class="audio-list" id="voiceList"></div>

      <div class="hint">
        Tip: Photos/voice are saved in your browser. If you clear browser data, memories can disappear.
      </div>
    </div>
  </div>

  <!-- DAYS -->
  <div class="days" id="days"></div>

  <!-- EDITOR -->
  <div id="editor">
    <h2 id="dayTitle"></h2>

    <div class="section">
      <h3>üíô My Thoughts</h3>
      <textarea id="myBox"></textarea>
    </div>

    <div class="section">
      <h3>üíñ My Food Panda Thoughts</h3>
      <textarea id="herBox"></textarea>
    </div>

    <!-- MEDIA (Selected Day) -->
    <div class="media-block">
      <div class="media-title">üì∏ Photos for this day</div>
      <div class="status" id="photoStatusEditor">No photos for this day.</div>
      <div class="thumbs" id="photoThumbsEditor"></div>

      <div class="media-title" style="margin-top:16px;">üéôÔ∏è Voice for this day</div>
      <div class="status" id="voiceStatusEditor">No voice notes for this day.</div>
      <div class="audio-list" id="voiceListEditor"></div>
    </div>

    <button class="save-btn" onclick="saveClose()">Save</button>
  </div>

  <script>
    // ---------- DATE / DAY LOGIC ----------
    const startDate = new Date("2026-01-01");
    const today = new Date();

    // Normalize to local midnight to avoid timezone/hour issues
    function toMidnight(d) {
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }

    const diffDays =
      Math.floor((toMidnight(today) - toMidnight(startDate)) / (1000 * 60 * 60 * 24)) + 1;

    const MAX_DAYS = 45;
    const currentDayNumber = Math.min(Math.max(diffDays, 1), MAX_DAYS);

    document.getElementById("todayTitle").innerText = `Day ${currentDayNumber}`;

    // ---------- TEXT STORAGE ----------
    const myToday = document.getElementById("myToday");
    const herToday = document.getElementById("herToday");

    myToday.value = localStorage.getItem("day" + currentDayNumber + "_my") || "";
    herToday.value = localStorage.getItem("day" + currentDayNumber + "_her") || "";

    function saveToday(who) {
      const key = "day" + currentDayNumber + "_" + who;
      const value = who === "my" ? myToday.value : herToday.value;
      localStorage.setItem(key, value);
      alert("Saved ‚ù§Ô∏è");
    }

    // Pre-fill ONLY for past days you want (1‚Äì14) IF not already saved
    const preset = {
      day1_my: "Day 1: Everything feels different without you.",
      day2_my: "Day 2: I keep checking my phone, hoping it‚Äôs you.",
      day3_my: "Day 3: Distance hurts, but love stays strong.",
      day4_my: "Day 4: Missing you became part of my routine.",
      day5_my: "Day 5: Even busy days end with your thoughts.",
      day6_my: "Day 6: I smiled today because of a memory.",
      day7_my: "Day 7: One week apart, still us.",
      day8_my: "Day 8: Loving you feels calm and heavy together.",
      day9_my: "Day 9: Random thought ‚Äî your laugh is my favorite sound.",
      day10_my: "Day 10: Some days feel long without you.",
      day11_my: "Day 11: I‚Äôm learning patience because of you.",
      day12_my: "Day 12: Missing you comes in waves.",
      day13_my: "Day 13: Almost there, holding hope.",
      day14_my: "Day 14: We're one step closer to being together."
    };

    for (let i = 1; i <= 14; i++) {
      const k = "day" + i + "_my";
      if (preset["day" + i + "_my"] && !localStorage.getItem(k)) {
        localStorage.setItem(k, preset["day" + i + "_my"]);
      }
    }

    // ---------- DAYS GRID (ONLY SHOW UP TO CURRENT DAY) ----------
    const daysDiv = document.getElementById("days");
    const editor = document.getElementById("editor");
    const myBox = document.getElementById("myBox");
    const herBox = document.getElementById("herBox");
    const dayTitle = document.getElementById("dayTitle");

    let openedDay = null;

    for (let i = 1; i <= currentDayNumber; i++) {
      const d = document.createElement("div");
      d.className = "day";
      d.innerText = "Day " + i;
      d.onclick = () => openDay(i);
      daysDiv.appendChild(d);
    }

    function openDay(num) {
      openedDay = num;
      dayTitle.innerText = "Day " + num;
      myBox.value = localStorage.getItem("day" + num + "_my") || "";
      herBox.value = localStorage.getItem("day" + num + "_her") || "";

      renderPhotosForDay(num, "editor");
      renderVoicesForDay(num, "editor");

      editor.style.display = "block";
      window.scrollTo({ top: editor.offsetTop - 10, behavior: "smooth" });
    }

    function saveClose() {
      if (!openedDay) return;
      localStorage.setItem("day" + openedDay + "_my", myBox.value);
      localStorage.setItem("day" + openedDay + "_her", herBox.value);
      editor.style.display = "none";
    }

    // ---------- PHOTOS (MULTIPLE) ----------
    const photoInput = document.getElementById("photoInput");
    const photoThumbs = document.getElementById("photoThumbs");
    const photoStatus = document.getElementById("photoStatus");

    const photoThumbsEditor = document.getElementById("photoThumbsEditor");
    const photoStatusEditor = document.getElementById("photoStatusEditor");

    function photosKey(day) {
      return "day" + day + "_photos";
    }

    function getPhotos(day) {
      try {
        return JSON.parse(localStorage.getItem(photosKey(day)) || "[]");
      } catch {
        return [];
      }
    }

    function setPhotos(day, arr) {
      localStorage.setItem(photosKey(day), JSON.stringify(arr));
    }

    function triggerPhotoPick() {
      photoInput.click();
    }

    photoInput.addEventListener("change", async () => {
      const files = Array.from(photoInput.files || []);
      if (!files.length) return;

      // Read all selected images -> base64
      const existing = getPhotos(currentDayNumber);

      for (const file of files) {
        const dataUrl = await readFileAsDataURL(file);
        existing.push(dataUrl);
      }

      setPhotos(currentDayNumber, existing);
      photoInput.value = "";
      renderPhotosForDay(currentDayNumber, "today");
      alert("Photos saved ‚ù§Ô∏è");
    });

    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onload = () => resolve(r.result);
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }

    function clearPhotosForDay(day) {
      if (!confirm("Remove all photos for this day?")) return;
      setPhotos(day, []);
      renderPhotosForDay(day, "today");
      if (openedDay === day) renderPhotosForDay(day, "editor");
    }

    function renderPhotosForDay(day, where) {
      const photos = getPhotos(day);

      if (where === "today") {
        photoThumbs.innerHTML = "";
        if (!photos.length) {
          photoStatus.textContent = "No photos added yet.";
          return;
        }
        photoStatus.textContent = photos.length + " photo(s) saved for Day " + day + ".";
        photos.forEach(src => {
          const wrap = document.createElement("div");
          wrap.className = "thumb";
          const img = document.createElement("img");
          img.src = src;
          wrap.appendChild(img);
          photoThumbs.appendChild(wrap);
        });
      } else {
        photoThumbsEditor.innerHTML = "";
        if (!photos.length) {
          photoStatusEditor.textContent = "No photos for this day.";
          return;
        }
        photoStatusEditor.textContent = photos.length + " photo(s) for Day " + day + ".";
        photos.forEach(src => {
          const wrap = document.createElement("div");
          wrap.className = "thumb";
          const img = document.createElement("img");
          img.src = src;
          wrap.appendChild(img);
          photoThumbsEditor.appendChild(wrap);
        });
      }
    }

    // Render today photos on load
    renderPhotosForDay(currentDayNumber, "today");

    // ---------- VOICE (MULTIPLE) ----------
    const startRecBtn = document.getElementById("startRecBtn");
    const stopRecBtn = document.getElementById("stopRecBtn");
    const voiceStatus = document.getElementById("voiceStatus");
    const voiceList = document.getElementById("voiceList");

    const voiceStatusEditor = document.getElementById("voiceStatusEditor");
    const voiceListEditor = document.getElementById("voiceListEditor");

    function voicesKey(day) {
      return "day" + day + "_voices";
    }

    function getVoices(day) {
      try {
        return JSON.parse(localStorage.getItem(voicesKey(day)) || "[]");
      } catch {
        return [];
      }
    }

    function setVoices(day, arr) {
      localStorage.setItem(voicesKey(day), JSON.stringify(arr));
    }

    let mediaRecorder = null;
    let audioChunks = [];
    let streamRef = null;

    async function startRecording() {
      try {
        streamRef = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(streamRef);
        audioChunks = [];

        mediaRecorder.ondataavailable = (e) => {
          if (e.data && e.data.size > 0) audioChunks.push(e.data);
        };

        mediaRecorder.onstop = async () => {
          const blob = new Blob(audioChunks, { type: "audio/webm" });
          const base64 = await blobToBase64(blob);

          const existing = getVoices(currentDayNumber);
          existing.push(base64);
          setVoices(currentDayNumber, existing);

          renderVoicesForDay(currentDayNumber, "today");
          alert("Voice note saved ‚ù§Ô∏è");

          // stop mic
          if (streamRef) {
            streamRef.getTracks().forEach(t => t.stop());
            streamRef = null;
          }
        };

        mediaRecorder.start();

        startRecBtn.disabled = true;
        stopRecBtn.disabled = false;
        voiceStatus.textContent = "Recording... click 'Stop & Save' to save.";
      } catch (err) {
        alert("Microphone permission denied or not available.");
        console.error(err);
      }
    }

    function stopRecording() {
      if (!mediaRecorder) return;
      if (mediaRecorder.state !== "inactive") mediaRecorder.stop();

      startRecBtn.disabled = false;
      stopRecBtn.disabled = true;
      voiceStatus.textContent = "Saving voice note...";
    }

    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onloadend = () => resolve(r.result);
        r.onerror = reject;
        r.readAsDataURL(blob);
      });
    }

    function clearVoicesForDay(day) {
      if (!confirm("Remove all voice notes for this day?")) return;
      setVoices(day, []);
      renderVoicesForDay(day, "today");
      if (openedDay === day) renderVoicesForDay(day, "editor");
    }

    function renderVoicesForDay(day, where) {
      const voices = getVoices(day);

      if (where === "today") {
        voiceList.innerHTML = "";
        if (!voices.length) {
          voiceStatus.textContent = "No voice notes yet.";
          return;
        }
        voiceStatus.textContent = voices.length + " voice note(s) saved for Day " + day + ".";
        voices.forEach((src) => {
          const item = document.createElement("div");
          item.className = "audio-item";
          const audio = document.createElement("audio");
          audio.controls = true;
          audio.src = src;
          item.appendChild(audio);
          voiceList.appendChild(item);
        });
      } else {
        voiceListEditor.innerHTML = "";
        if (!voices.length) {
          voiceStatusEditor.textContent = "No voice notes for this day.";
          return;
        }
        voiceStatusEditor.textContent = voices.length + " voice note(s) for Day " + day + ".";
        voices.forEach((src) => {
          const item = document.createElement("div");
          item.className = "audio-item";
          const audio = document.createElement("audio");
          audio.controls = true;
          audio.src = src;
          item.appendChild(audio);
          voiceListEditor.appendChild(item);
        });
      }
    }

    // Render today voices on load
    renderVoicesForDay(currentDayNumber, "today");
  </script>
</body>
</html>


